<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="firstportfolio.wordcharger.repository.PostsMapper">

    <select id="findAllPostsCount" resultType="Integer">
        SELECT COUNT(*) FROM POSTS
    </select>

<!--    <select id="findCurrentPagePosts" resultType="PostsDTO">-->
<!--        SELECT posts.*, post_view.view_number-->
<!--        FROM posts-->
<!--        LEFT OUTER JOIN post_view ON posts.id = post_view.post_id-->
<!--        ORDER BY posts.id DESC-->
<!--        OFFSET #{startRow} ROWS-->
<!--        FETCH NEXT #{pageSize} ROWS ONLY-->
<!--    </select>-->

    <select id="findCurrentPagePosts" resultType="PostsDTO">
        SELECT posts.*, post_view.view_number, member.user_id
        FROM posts
        LEFT OUTER JOIN post_view ON posts.id = post_view.post_id
        LEFT OUTER JOIN member ON posts.member_id = member.id
        ORDER BY posts.id DESC
        OFFSET #{startRow} ROWS
        FETCH NEXT #{pageSize} ROWS ONLY
    </select>

    <insert id="insertPost">
        INSERT INTO posts (id, member_id, title, is_private, writing_date, content)
        values (#{selectNextSequenceValue}, #{memberId}, #{title}, #{isPrivate}, SYSDATE, #{content})
    </insert>

    <select id="findPostById" resultType="PostsDTO">
        SELECT * FROM posts
        WHERE id = #{postId}
    </select>

    <select id="findPostByTitle" resultType="PostsDTO">
        SELECT posts.*, member.user_id
        FROM posts
        LEFT OUTER JOIN member ON posts.member_id = member.id
        WHERE title = #{hintToFind}
        ORDER BY posts.id DESC
    </select>

<!--    SELECT * FROM posts-->
<!--    WHERE title = #{hintToFind}-->

    <select id="findPostByMemberId" resultType="PostsDTO">
<!--        SELECT * FROM posts-->
<!--        WHERE member_id = #{memberId}-->
        SELECT posts.*, member.user_id
        FROM posts
        LEFT OUTER JOIN member ON posts.member_id = member.id
        WHERE member_id = #{hintToFind}
        ORDER BY posts.id DESC
    </select>

    <select id="findPostByContent" resultType="PostsDTO">

<!--        SELECT * FROM posts-->
<!--        WHERE content LIKE #{hintToFind}-->
        SELECT posts.*, member.user_id
        FROM posts
        LEFT OUTER JOIN member ON posts.member_id = member.id
        WHERE content LIKE #{hintToFind}
        ORDER BY posts.id DESC

    </select>


    <!--시퀀스의 다음값 얻어오기-->
    <select id="selectNextSequenceValue" resultType="Integer">
        SELECT POSTS_SEQUENCE.NEXTVAL FROM DUAL
    </select>



</mapper>